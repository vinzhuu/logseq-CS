tags:: [[微信支付 - 委托代扣]]
---

- ## 签约方式
	- 采用 **支付中签约** 的方式.
		- ==貌似 **先纯签约, 再支付** 的方式是 **先享后付** 业务的?==
	- **支付中签约** 目前只看到 V2 的, 没看到 V3 的.
- ## 涉及的 API
	- 微信提供:
	  logseq.order-list-type:: number
		- [支付中签约](https://pay.weixin.qq.com/doc/v2/merchant/4011987320)
		  logseq.order-list-type:: number
		- [查询订单](https://pay.weixin.qq.com/doc/v2/merchant/4011987538)
		  logseq.order-list-type:: number
		- [查询签约关系](https://pay.weixin.qq.com/doc/v2/merchant/4011987640)
		  logseq.order-list-type:: number
		- [申请解约](https://pay.weixin.qq.com/doc/v2/merchant/4011987432)
		  logseq.order-list-type:: number
	- 商户提供:
	  logseq.order-list-type:: number
		- [扣款结果通知](https://pay.weixin.qq.com/doc/v2/merchant/4011987465)
		  logseq.order-list-type:: number
		- [签约、解约结果通知](https://pay.weixin.qq.com/doc/v2/merchant/4011987586)
		  logseq.order-list-type:: number
- ## 支付中签约流程
	- **用户** 选择 "自动续费" 产品, 点击 "支付" 按钮.
	  logseq.order-list-type:: number
	- **前端** 调用 **后端签约接口** (传入 `trade_type` 指定支付方式)
	  logseq.order-list-type:: number
	- **后端签约接口** 调用 **微信 [支付中签约] API** , 根据 `trade_type` 给 **前端** 返回其拉起 **微信 APP** 需要的参数 .
	  logseq.order-list-type:: number
	- **前端** 拉起 **微信 APP** , **用户** 可以进行 "支付并签约" .
	  logseq.order-list-type:: number
	- **后端** 获取 **支付结果** 和 **签约结果** .
	  logseq.order-list-type:: number
		- **支付结果** : 通过被动接收 **扣款结果通知** 和 主动调用 **微信 [查询订单] API** 来获取.
		- **签约结果** : 通过被动接收 **签约、解约结果通知** 和 主动调用 **微信 [查询签约关系] API** 来获取.
	- **后端** 根据 **支付结果** 和 **签约结果** , 来做后续的 **业务处理** .
	  logseq.order-list-type:: number
		- ==疑问: 这两个结果应该如何处理? ==
			- 如果支付成功, 是否签约也必然成功? 是否有 "只支付, 而未签约" 的情况?
			  logseq.order-list-type:: number
			- 如果支付失败, 是否签约也必然失败? 是否有 "未支付, 但完成签约" 的情况?
			  logseq.order-list-type:: number
- ## 解约流程
	- **用户** 点击 "解约" 按钮.
	  logseq.order-list-type:: number
	- **前端** 调用 **后端解约接口** .
	  logseq.order-list-type:: number
	- **后端解约接口** 调用 **微信 [申请解约] 接口** .
	  logseq.order-list-type:: number
	- **后端** 通过被动接收 **签约、解约结果通知** 和 主动调用 **微信 [查询签约关系] API** 来获取 **解约结果** .
	  logseq.order-list-type:: number
	- **后端** 根据 **解约结果** , 来做后续的 **业务处理** .
	  logseq.order-list-type:: number
- ## 退款流程
	- ==暂未了解==
- ## 参考
	- [支付中签约](https://pay.weixin.qq.com/doc/v2/merchant/4011987320)
	  logseq.order-list-type:: number
	- logseq.order-list-type:: number